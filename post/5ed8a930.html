<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>网络安全协议 | Ann の 小窝</title><meta name="author" content="Ann"><meta name="copyright" content="Ann"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Chapter 1 网络安全综述 Chapter3 IPsec：AH和ESP  AH和ESP认证的区别  AH认证范围是整个数据包，不包括可变域 ESP认证范围是不包括IP头的数据包，并在尾部添加认证数据 AH中认证是必选的，ESP是可选的（一般不选）   顺序和原因  先ESP再AH，验证先AH再ESP：节省开销 PGP中签名（认证）-压缩-加密：   Chapter 1 网络安全综述 预置">
<meta property="og:type" content="article">
<meta property="og:title" content="网络安全协议">
<meta property="og:url" content="https://ann-103.github.io/post/5ed8a930.html">
<meta property="og:site_name" content="Ann の 小窝">
<meta property="og:description" content="Chapter 1 网络安全综述 Chapter3 IPsec：AH和ESP  AH和ESP认证的区别  AH认证范围是整个数据包，不包括可变域 ESP认证范围是不包括IP头的数据包，并在尾部添加认证数据 AH中认证是必选的，ESP是可选的（一般不选）   顺序和原因  先ESP再AH，验证先AH再ESP：节省开销 PGP中签名（认证）-压缩-加密：   Chapter 1 网络安全综述 预置">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ann-103.github.io/img/pinkcloud.jpg">
<meta property="article:published_time" content="2023-03-12T23:55:49.000Z">
<meta property="article:modified_time" content="2023-07-03T11:20:30.638Z">
<meta property="article:author" content="Ann">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ann-103.github.io/img/pinkcloud.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://ann-103.github.io/post/5ed8a930"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"YD8D4MBDZ4","apiKey":"cae15c3362dd9749a20b9f3989daccd4","indexName":"blog","hits":{"per_page":6},"languages":{"input_placeholder":"搜索文章","hits_empty":"找不到您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，用时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '网络安全协议',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-03 19:20:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/rightMenu.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/css/bbtalk.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="/css/bb_index.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/css/main.css"><link rel="stylesheet" href="/css/categorybar.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@1.0.17/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="wizard-scene"><div class="wizard-objects"><div class="wizard-square"></div><div class="wizard-circle"></div><div class="wizard-triangle"></div></div><div class="wizard"><div class="wizard-body"></div><div class="wizard-right-arm"><div class="wizard-right-hand"></div></div><div class="wizard-left-arm"><div class="wizard-left-hand"></div></div><div class="wizard-head"><div class="wizard-beard"></div><div class="wizard-face"><div class="wizard-adds"></div></div><div class="wizard-hat"><div class="wizard-hat-of-the-hat"></div><div class="wizard-four-point-star --first"></div><div class="wizard-four-point-star --second"></div><div class="wizard-four-point-star --third"></div></div></div></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 碎碎念</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child" style="right:-90px"><li><a class="site-page child" href="/ispeaker/"><i class="fa-fw fas fa-paper-plane"></i><span> 说说</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 工具箱</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Ann の 小窝</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 碎碎念</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child" style="right:-90px"><li><a class="site-page child" href="/ispeaker/"><i class="fa-fw fas fa-paper-plane"></i><span> 说说</span></a></li><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 工具箱</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">网络安全协议</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-03-12T23:55:49.000Z" title="发表于 2023-03-13 07:55:49">2023-03-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-03T11:20:30.638Z" title="更新于 2023-07-03 19:20:30">2023-07-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">15.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>48分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="网络安全协议"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h1 id="Chapter-1-网络安全综述">Chapter 1 网络安全综述</h1>
<h1 id="Chapter3-IPsec：AH和ESP">Chapter3 IPsec：AH和ESP</h1>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230419114025890.png" alt="image-20230419114025890" style="zoom:67%;" />
<h3 id="AH和ESP认证的区别">AH和ESP认证的区别</h3>
<ol>
<li>AH认证范围是整个数据包，不包括可变域</li>
<li>ESP认证范围是不包括IP头的数据包，并在尾部添加认证数据</li>
<li>AH中认证是必选的，ESP是可选的（一般不选）</li>
</ol>
<blockquote>
<p>顺序和原因</p>
<ul>
<li>先ESP再AH，验证先AH再ESP：节省开销</li>
<li>PGP中签名（认证）-压缩-加密：</li>
</ul>
</blockquote>
<h1 id="Chapter-1-网络安全综述-2">Chapter 1 网络安全综述</h1>
<h2 id="预置">预置</h2>
<ul>
<li>计算机网络
<ul>
<li>分层</li>
<li>协议</li>
<li>接口</li>
</ul>
</li>
</ul>
<blockquote>
<p>管道化：粗细（v），时延，丢包（链路底层或者路由拥塞）</p>
<p>IP包长度4字节，4<strong>5</strong>00代表20B，段偏移8B</p>
</blockquote>
<ul>
<li>密码学
<ul>
<li>非对称加密
<ul>
<li>加密-BOB公钥，传递密钥（短）</li>
<li>签名-Alice私钥（长）（一般两者不同）</li>
</ul>
</li>
<li>对称加密：一般对称传输</li>
<li>Hash</li>
</ul>
</li>
</ul>
<blockquote>
<p>文本保护：Hash mac函数，数字签名</p>
<p>数字信封：对端公钥，加密会话秘钥</p>
</blockquote>
<h2 id="概念">概念</h2>
<p>常见的<strong>不安全因素</strong></p>
<ul>
<li>
<p>物理因素：物理设备的不安全，电磁波泄漏等</p>
</li>
<li>
<p>系统因素：系统软、硬件漏洞，病毒感染，入侵</p>
</li>
<li>
<p><strong>网络因素</strong>：网络<strong>协议</strong>漏洞，<strong>会话</strong>劫持、数据篡改，网络拥塞，拒绝服务</p>
</li>
<li>
<p>管理因素：管理员安全意识淡漠，误操作</p>
</li>
</ul>
<p>不安全的原因：</p>
<ul>
<li>自身的缺陷：系统软硬件缺陷、网络协议的缺陷</li>
<li>开放性
<ul>
<li>系统开放：计算机及计算机通信系统是根据行业标准规定的接口建立起来的。</li>
<li>标准开放：网络运行的各层协议是开放的，并且标准的制定也是开放的。</li>
<li>业务开放：用户可以根据需要开发新的业务</li>
</ul>
</li>
<li>黑客攻击</li>
</ul>
<h3 id="网络安全的特征">网络安全的特征</h3>
<ul>
<li>机密性：信息不泄漏给非授权的用户、实体或者过程的特性。</li>
<li>完整性：数据未经授权不能进行改变的特性，即信息在存储或传输过程中保持不被修改、不被破坏的特性。</li>
<li>可用性：可被授权实体访问并按需求使用的特性，即当需要时应能存取所需的信息。</li>
<li>（可控性）：对网络信息的传播及内容具有控制能力</li>
<li>（不可否认）：（可审计性）</li>
</ul>
<blockquote>
<ul>
<li>可认证性：用户端认证，数据源认证，根据不同方向时间功能生成密钥种子的单向函数</li>
</ul>
</blockquote>
<p><strong>常见攻击</strong>：社会工程、口令破解、地址欺骗、连接盗用、网络窃听、数据篡改、恶意扫描、基础设施破坏、拒绝服务、数据驱动攻击。总的来说有：</p>
<ul>
<li><strong>中断</strong>：可用性</li>
<li>窃听：机密性</li>
<li>修改：完整性</li>
<li><strong>伪造</strong>：可认证性</li>
</ul>
<h2 id="安全模型、安全体系结构">安全模型、安全体系结构</h2>
<blockquote>
<p>参考模型有ISO-OSI，TCPIp</p>
</blockquote>
<h3 id="安全体系结构">安全体系结构</h3>
<p>在X.800中定义为安全攻击、安全机制、安全服务三个层面。用一种或多种安全机制来实现安全服务，安全服务致力于抵御安全攻击。</p>
<ul>
<li>
<p><strong>安全攻击</strong>：</p>
<ul>
<li><strong>主动攻击</strong>：篡改、伪装、重放【从无到有】、拒绝服务【从有到无】</li>
<li><strong>被动攻击</strong>：窃听、流量分析</li>
<li>区别在于会不会<strong>主动改变数据流</strong></li>
</ul>
</li>
<li>
<p><strong>安全机制</strong>：加密、数字签名、<strong>访问控制</strong>、数据完整性、认证交换、流量填充、路由控制、公证</p>
<blockquote>
<p>填充：填充信息防止流量分析</p>
<ul>
<li>协议字段整数倍【IP】，或者算法</li>
<li>协议设计规范要求32位对齐</li>
<li>被动攻击通过长度得到特征，通过填充消除</li>
</ul>
<p>路由控制：为特定数据选择基于路由的安全通道</p>
<p>普通安全技术：可信功能，安全标记，事件检测，安全审计跟踪，安全恢复（价值）</p>
</blockquote>
</li>
<li>
<p><strong>安全服务</strong>：X.800定义了5类14种安全服务</p>
<ul>
<li><strong>认证</strong>：对等实体认证、数据源认证访问控制【区别！】</li>
<li><strong>数据机密性</strong>：连接保密性、无连接保密性、选择域保密性、流量保密性</li>
<li><strong>数据完整性</strong>：具有恢复功能的连接完整性、无恢复功能的连接完整性、选择与连接完整性、无连接</li>
<li><strong>完整性</strong>：选择域无连接完整性</li>
<li><strong>不可否认性</strong>：源点的不可否认性、信宿的不可否认性</li>
</ul>
</li>
</ul>
<h3 id="安全模型">安全模型</h3>
<ul>
<li>
<p>网络安全（通信）模型：实现端到端的安全通信。安全通道等</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230315140520643-16883590603281.png" alt="image-20230315140520643" style="zoom:80%;" />
</li>
<li>
<p>网络访问安全模型：保护信息系统免遭恶意访问。防火墙等</p>
</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230315140546420-16883590603292.png" alt="image-20230315140546420" style="zoom:80%;" />
<h2 id="密码相关">密码相关</h2>
<table>
<thead>
<tr>
<th>概念</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>分组密码</td>
<td>DES、AES、RC5、IDEA、Blowfish、CAST-128</td>
<td></td>
</tr>
<tr>
<td>公钥密码</td>
<td>RSA、ECC、ElGamal</td>
<td></td>
</tr>
<tr>
<td>流密码</td>
<td>RC4</td>
<td></td>
</tr>
<tr>
<td>散列函数</td>
<td>MD5（128）、SHA系列、RIPEMD</td>
<td>**SHA1（160）**SHA2   (256)</td>
</tr>
<tr>
<td>单向陷门函数</td>
<td>在知道秘密消息（陷门）之后可以通过y求得x</td>
<td></td>
</tr>
<tr>
<td>分组密码模式</td>
<td>ecb，cbc，cfb，ofb，ctr</td>
<td></td>
</tr>
<tr>
<td>RSA</td>
<td><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329153347854.png" alt="image-20230329153347854" style="zoom: 50%;" /></td>
<td></td>
</tr>
<tr>
<td>DH密钥交换算法</td>
<td><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329153411434.png" alt="image-20230329153411434" style="zoom: 50%;" /></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="基本的加密认证、密钥交换密码">基本的加密认证、密钥交换密码</h2>
<ul>
<li>
<p>用户认证：基于挑战应答：对称加密，签名，非对称，HMAC</p>
<blockquote>
<p>挑战应答之后进行DH交换密钥</p>
</blockquote>
</li>
<li>
<p>数据源认证（签名，HMAC）</p>
<blockquote>
<p>既然DH已经交换了密钥(数据完整性密钥)，最好就HMAC，如果没有密钥协商则就只用签名的方法</p>
</blockquote>
</li>
<li>
<p>机密性，完整性保护：机密性主要是分组的加密模式，IV值的使用和作用</p>
<blockquote>
<p>iv直接作用于第一个分组，后续来自于一组的加密结果，iv保证即使相同的明文对应的密文也不同。</p>
</blockquote>
</li>
</ul>
<h1 id="Chapter-2-PKI">Chapter 2 PKI</h1>
<blockquote>
<p>在公钥密码中，如何将公钥和个体联系起来</p>
</blockquote>
<h3 id="PKI概念总览">PKI概念总览</h3>
<table>
<thead>
<tr>
<th>概念</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>PKI</td>
<td>用<strong>非对称密码算法原理和技术</strong>来实现并提供安全服务的具有通用性的<strong>安全基础设施</strong>。</td>
<td>遵循标准的技术规范，提供密钥和证书管理</td>
</tr>
<tr>
<td>PKI组成</td>
<td>CA、RA、证书库、密钥备份及恢复系统、证书作废处理系统 、自动密钥更新  、密钥历史档案</td>
<td>RA审核，CA颁发证书</td>
</tr>
<tr>
<td>PKI完整性</td>
<td>数字签名、消息认证码（HMAC）</td>
<td>数字签名还提供不可否认性</td>
</tr>
<tr>
<td>PKI保密性</td>
<td>数字信封传递会话密钥</td>
<td></td>
</tr>
<tr>
<td>CRL证书作废列表</td>
<td>上一个到当前时间节点的签发</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>必要性</strong></p>
<ul>
<li>技术规范：<strong>统一标准</strong></li>
<li>对可信第三方需要（CA）</li>
<li>收发双方不需要事先共享密钥，公钥加密传输会话秘钥（数字信封）</li>
<li>在收发双方建立信任关系，提供身份认证、数字签名、加密等安全服务</li>
</ul>
<p><strong>提供的服务</strong></p>
<ul>
<li>认证：实体认证，数据源认证</li>
<li><strong>完整性</strong>：哈希+数字签名技术；消息认证码(参数：数字信封or DH协商)</li>
<li><strong>机密性</strong>：数字信封传递会话密钥</li>
<li>不可否认性：数字签名、时间戳</li>
<li>公证：CA充当可信第三方</li>
</ul>
<blockquote>
<p>hash+签名：有限长度，且微小变化会造成结果大变【无交互】</p>
<p>hmac：协商完整性保护密钥，相比数字签名不可以抗否认【优先】</p>
</blockquote>
<p>Q:如何防止重放攻击进行认证（中间人）？</p>
<h3 id="PKI的组成">PKI的组成</h3>
<p>PKI策略+软硬件系统 -&gt;CA RA 证书管理系统 -&gt;PKI应用</p>
<ul>
<li>
<p><strong>认证中心</strong>CA：证书的签发机构，它是PKI的核心构件，是PKI应用中权威的、可信任的、公正的第三方机构。</p>
<blockquote>
<p>小规模进行签发证书、核验可以都由CA进行，大规模用RA核验</p>
</blockquote>
</li>
<li>
<p><strong>注册机构</strong>RA：多个RA可以分担CA的功能 ，作为CA的延展，可以增强可扩展性  ，按照特定的政策和管理规范对用户的<strong>资格进行审查</strong>，并执行是否同意给该申请人发放、撤销证书等操作，应注意的<strong>是RA不容许直接颁发证书或CRL</strong></p>
<blockquote>
<p>RA可以有0个或者多个，颁发需要CA的密钥</p>
</blockquote>
</li>
<li>
<p><strong>证书库</strong>：CA颁发证书和证书撤销列表CRL的集中存放地，提供公众查询，常用目录服务器提供服务，采用LDAP（Lightweight Directory Access Protocol）目录访问协议。【实体公钥】【验证通信实体的证书是否在CRL中  】</p>
<blockquote>
<p>在生命周期内撤销比如挂失卡，通过周期性分发CRL</p>
</blockquote>
</li>
<li>
<p><strong>密钥备份及恢复系统</strong>：</p>
<ul>
<li>签名密钥对：签名私钥相当于日常生活中的印章效力，为保证其唯一性、抗否认性，<strong>签名私钥不作备份</strong>。签名密钥的<strong>生命期较长</strong>。</li>
<li>加密密钥对：加密密钥通常用于分发<strong>会话密钥</strong>，为防止密钥丢失时无法解密数据，<strong>解密密钥应进行备份</strong>。这种密钥应<strong>频繁更换</strong>。</li>
</ul>
<blockquote>
<p>对于加解密的文件，需要保证加密密钥存在</p>
</blockquote>
</li>
<li>
<p>证书<strong>作废</strong>处理系统：证书由于某种原因需要作废，终止使用，这将通过<strong>证书作废列表</strong>（CRL）记录</p>
<blockquote>
<p>证书生成后会有可信域内唯一的id，使用撤销列表记录有效期。如果有实时更新则需要在线处理。可以=在线和离线操作，离线操作涉及推送传输和存储问题。</p>
</blockquote>
</li>
<li>
<p><strong>自动</strong>密钥更新：无需用户干预，当证书失效日期到来时，启动更新过程，生成新的证书</p>
</li>
<li>
<p>密钥<strong>历史档案</strong>：由于密钥更新，每个用户都会拥有多个旧证书和至少一个当前证书，这一系列证书及相应私钥（<strong>除签名私钥</strong>）组成密钥历史</p>
<blockquote>
<p>签名密钥对是不需要备份的【生命周期长】，而加密密钥需要备份，用于破解之前【更容易，频繁】</p>
</blockquote>
</li>
</ul>
<blockquote>
<ul>
<li>
<p>PKI应用接口系统 是为各种各样的应用提供安全、一致、可信任的方式与PKI交互, 确保所建立起来的网络环境安全可信,并降低管理成本。</p>
</li>
<li>
<p>交叉认证 多个PKI独立地运行, 相互之间应建立信任关系</p>
</li>
</ul>
</blockquote>
<h3 id="PKI和电子商务中常用的密码技术">PKI和电子商务中常用的密码技术</h3>
<table>
<thead>
<tr>
<th>概念</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>数字签名</td>
<td>Hash生成摘要，<strong>签名私钥</strong>对其进行<strong>加密</strong>计算，将计算结果附在原文上进行传输。接收方收到后对原文计算Hash，并对签名结果使用<strong>签名公钥解密</strong>，然后将二者进行比较。</td>
<td>用私钥加密计算的是Hash的结果，而不是原文</td>
</tr>
<tr>
<td>数字信封</td>
<td>信息发送端<strong>用接收端的公钥</strong>，将一个通信密钥(即对称密钥)K给予加密，生成一个数字信封。接收方用自己的<strong>私钥打开</strong>数字信封，<strong>获得K</strong></td>
<td>对方公钥加密会话密钥</td>
</tr>
<tr>
<td>挑战响应</td>
<td>在不展示密钥的前提下证明你拥有这个密钥。例如对称密钥加密某个文件，数据源认证，如果随机生成nonce加密后返还解密，则实体认证。所有的密码都可以进行这个过程。</td>
<td>对称密码无法实现抗否认</td>
</tr>
<tr>
<td>先加密后签名</td>
<td>验证签名如果不对直接over，从<strong>开销</strong>角度来看。如果开销不大，那么顺序还是优化百分比都不重要。（一般认为sign和E开销1：1，但是如果是大文件，则对称加密的开销很大，但是hash的开销比较小）</td>
<td>时间因素，线性开销则周期次数减少，与人有关的实现批量操作？</td>
</tr>
</tbody>
</table>
<ol>
<li>信息加密/解密</li>
<li>数字签名</li>
<li>报文检验码</li>
<li>数字信封：采用收方的公钥对随机产生的会话密钥进行加密</li>
<li>双重数字签名（在SET协议中讲述）</li>
</ol>
<blockquote>
<p>分组加密：目的是相同分组不同结果，iv针对第一个分组。其实iv的存在就是为了相同信息能够加密成不同密文</p>
<p>优先：选择对称算法，不安全的低成本算法比如rc4直接异或</p>
<p>旁路协商对称密钥，不在原本的信道</p>
<p>密钥协商：DH无法抵抗中间人，仍然需要双向认证，成本依旧【首次的交互】</p>
</blockquote>
<h4 id="数字信封"><strong>数字信封</strong></h4>
<ul>
<li>数字信封的例子这里的顺序问题需要具体修改【两张图的顺序有错】</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329145409253-16883590603303.png" alt="image-20230329145409253" style="zoom: 67%;" />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329145425616-16883590603304.png" alt="image-20230329145425616" style="zoom:67%;" />
<p><strong>数字签名</strong></p>
<ul>
<li>如果是对于短消息，跳过hash后签名过程变成直接hash</li>
<li>但是实际并不会那么复杂，一是仍然保证原消息的更改造成结果的更改幅度，二是比较的实现？</li>
</ul>
<p>（最后一句话对大文件适用可以去掉，因为小文件也可以用一套方法处理，当然也可以不处理。）</p>
<ul>
<li>发方公钥的验证也就是通过证书</li>
</ul>
<blockquote>
<p>再次强调，如果可以交互使用的是DH</p>
</blockquote>
<h3 id="PKI功能操作概述">PKI功能操作概述</h3>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329151521409-16883590603305.png" alt="image-20230329151521409" style="zoom: 67%;" />
<ul>
<li>
<p>56步，首先是离线验证证书有效性，然后查询CRL，然后公钥确认，用于确认数字签名，最后验证邮件</p>
</li>
<li>
<p>端实体与RA交互，CA与RA交互，进行访问控制，保护系统安全</p>
</li>
<li>
<p>签名验证：message+sign，首先使用CA的公钥对后面的sign解密，当不在一个可信域的时候，进行证书链的验证</p>
</li>
<li>
<p>CRL</p>
</li>
<li>
<p>验证内部信息，id格式，密钥用途格式等</p>
</li>
</ul>
<h3 id="证书概览">证书概览</h3>
<blockquote>
<p>证书的生命周期，证书链和交叉认证。</p>
<p>公钥加密、数字签名的密钥在证书维护上的区别。(私钥和公钥的维护)</p>
</blockquote>
<p><strong>重点</strong>：通过可信CA的签名实现<strong>主体身份和主体公钥</strong>之间的绑定关系</p>
<table>
<thead>
<tr>
<th>概念</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>证书的基本结构</td>
<td>主体身份信息、主体公钥值、认证机构名、认证机构的数字签名。</td>
<td>前三者是最基本的功能成分</td>
</tr>
<tr>
<td>证书产生</td>
<td>1）端实体向证书机构CA提出数字证书申请；2）CA 验明端实体身份，并签发数字证书；3）CA 将证书公布到证书库中。</td>
<td></td>
</tr>
<tr>
<td>证书撤销</td>
<td>CA将其放入CRL列表</td>
<td>过期、用户私钥泄露、用户和CA的信任关系终止、CA签名私钥泄露</td>
</tr>
<tr>
<td>证书验证</td>
<td>检查数字签名—检查内容（有效期等）—检查CRL列表</td>
<td>事实上还对于密钥的保护有关，比如使用加密密钥对使用到了签名密钥对里面，</td>
</tr>
<tr>
<td>离线和在线</td>
<td>本地是存储开销和及时性，在线是查询开销；离线是周期性的推送给用户，用户端个人维护CRL</td>
<td></td>
</tr>
</tbody>
</table>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230320082601690-16883590603306.png" alt="image-20230320082601690" style="zoom: 50%;" />
<blockquote>
<p>私钥是个人保存，但有情景为第三方生成后个人取回</p>
<p>CA设置信息并生成数字签名，用户使用CA的公钥验证是否合法</p>
<p>（t,n）门限，冗余备份，n&gt;t，找到t个</p>
</blockquote>
<p>问题：DH扩展为组内密钥，且动态变化组内成员，无法查看加入之前的内容</p>
<blockquote>
<p>ps:</p>
<p>对多CA的信任，对CA的公钥验证，需要有一个信任锚点，构成信任链条。</p>
<p>CA颁发的证书，则需要考虑两者的交互</p>
</blockquote>
<h3 id="证书的生命周期">证书的生命周期</h3>
<p>初始化 -&gt; 使用 -&gt; 撤销  （过期）</p>
<div class="tabs" id="程"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#程-1">初始化</button></li><li class="tab"><button type="button" data-href="#程-2">使用</button></li><li class="tab"><button type="button" data-href="#程-3">过期或撤销阶段</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="程-1"><p><strong>初始化</strong></p>
<ul>
<li>
<p>终端实体注册</p>
</li>
<li>
<p>密钥对产生</p>
<ul>
<li>用户，CA，其他可信第三方</li>
</ul>
</li>
<li>
<p>证书创建</p>
<ul>
<li><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230327080126090-16883590603307.png" alt="image-20230327080126090"></li>
</ul>
</li>
<li>
<p>证书分发</p>
</li>
<li>
<p>密钥备份</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230327080246671-16883590603308.png" alt="image-20230327080246671" style="zoom:67%;" />
</li>
</ul><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="程-2"><p><strong>证书使用</strong></p>
<ul>
<li>证书获取：发送者附加证书，单独发送或者从目录服务器or其他站点</li>
<li>证书验证：验证CA签名以及验证是否在<strong>CRL</strong>中，<strong>证书链</strong>、<strong>序列号</strong>、<strong>有效期是否有效等</strong>
<ul>
<li>迭代寻找证书链中下一个证书和其上级CA证书，然后使用CA的公钥核验CA的数字签名</li>
<li>使用每一个证书前都要检查CRL</li>
<li>核验语义信息（比如用于加密的密钥）-&gt; 检查完整 -&gt;检查CRL</li>
</ul>
</li>
<li>密钥恢复：加密密钥丢了可以找CA或信任第三方恢复</li>
<li>密钥更新：合法密钥快过期时，自动产生新的密钥并颁发证书</li>
</ul>
<details class="folding-tag" ><summary> 证书验证 </summary>
              <div class='content'>
              <blockquote><p>证书验证补充：</p><ol><li>拆封证书：获得公钥验证是CA签发的，即对签名的验证</li><li>证书链的认证（直到信任锚点/根）：追溯后自顶向下确认有效性</li><li>序列号验证</li><li>有效期验证 ：还有起始日期</li><li>证书撤销列表查询</li><li>证书使用策略的认证</li><li>最终用户实体证书的确认</li></ol></blockquote>
              </div>
            </details>
<blockquote>
<p>关于认证的问题：</p>
<p>对于电信是将密钥存在sim中固定，而对于量子通信会有密钥对存储充注给物理信道？而后及时更换。【量子密话】（用户和基站之间是无线，故需要建立安全通道，而运营商服务器和基站之间一般有线）（而对于个人访问校园网，AP不在接收范围内？建立双向认证防止中间人攻击，然后dh协商密钥，建立安全通道？）</p>
<ol>
<li>AB进行挑战应答，来回四步，中间两步可以合并（tcp）</li>
<li>CS架构，用户与服务器（共享阈值？？），依旧挑战应答，一定做的是对客户端认证，服务器端的认证可选。比如导致电信伪基站广告啥的。</li>
<li>特殊场景https：双向认证但是不同方式，比如在协议之外进行对用户的认证？</li>
</ol>
<p>诚实并好奇：商业CA模式</p>
</blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="程-3"><p><strong>过期或撤销阶段</strong></p>
<ul>
<li>
<p>证书过期：证书生命周期的自然结束</p>
</li>
<li>
<p>证书撤销：证书在过期之前被撤销。比如<strong>过期，用户私钥泄露、信任关系终止、CA签名私钥泄露或者变更等</strong></p>
<blockquote>
<p>查询CRL：在线请求不是一对一可能是一次发多个，离线推送问题。因为前两步验证签名离线即可实现</p>
</blockquote>
</li>
<li>
<p>存档：维持一个历史证书记录，以便解密之前的信息</p>
</li>
<li>
<p>审计信息</p>
</li>
</ul>
<blockquote>
<p>CRL本地离线存储只需要维护序列号？</p>
</blockquote><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>
<p>！<strong>证书存储的是用户公钥，主要作用是用户主体身份和与公钥的绑定信息</strong></p>
<blockquote>
<p>tcp中关于时间的三次重传，然后就不传了，三次ack快速重传</p>
<p>周期性重启后发送信号，以及休眠监听开销等策略如何有机结合在线查询和离线的休眠</p>
</blockquote>
<h3 id="PKI体系的互通性与标准化">PKI体系的互通性与标准化</h3>
<table>
<thead>
<tr>
<th>概念</th>
<th>解释</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td>信任关系</td>
<td>统一，交叉（双向），层次（单向），分布式CA（单向）</td>
<td></td>
</tr>
<tr>
<td>信任</td>
<td>如果一个实体假定另一个实体会严格的像它期望的那样行动,就称它信任那个实体</td>
<td></td>
</tr>
<tr>
<td>可信CA</td>
<td>如果一个个体假设CA能够建立并维持一个准确的“个体-公钥属性”之间的绑定，则他可以信任该CA</td>
<td></td>
</tr>
<tr>
<td>分布式信任模型</td>
<td>CA中心相对独立；风险分散  ；桥式CA的作用的只是认证范围的扩展或收缩，可以兼容已有CA中心</td>
<td></td>
</tr>
</tbody>
</table>
<blockquote>
<p>信任只需要考虑是否能够处理某件事即可</p>
<p>扩展：A-B，B-C，则AC之间的信任关系有多种策略，利用多个B进行综合评定比如分级，打分</p>
<p>某个CA可以被另外的CA签发证书以表示其可信</p>
<p>一般有集中式就不会考虑分布式</p>
<p>分布式增加了开销降低性能以提高系统的健壮性</p>
</blockquote>
<p><strong>证书链</strong>：由不同CA创建的证书序列构成，每个连续的证书都是由CA颁发的证明下一个CA公钥可信任的证书。</p>
<p><strong>严格的层次模型</strong>：易于控制，但是根一旦被破坏整个体系都会受影响。证书链如下图</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230327081819228-16883590603309.png" alt="image-20230327081819228" style="zoom: 60%;" />
<p><strong>分布式信任结构模型</strong>：鲁棒性好，可拓展性好，CA间通过交叉认证在不同的CA之间建立信任。但是证书链不确定，可能会很长。更有可能出现环路。证书链如下图</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230327081833046-168835906033010.png" alt="image-20230327081833046" style="zoom:60%;" />
<p><strong>桥式结构</strong>：首先要建立一个桥CA，桥CA在不同的PKI体系之间起<strong>信任桥梁</strong>的作用，它不直接向用户签发证书，也不作为体系中用户的一个信任点，只用来建立一个端到端的信任关系。</p>
<p>混合结构</p>
<h3 id="X-509标准">X.509标准</h3>
<p>目前使用最多的为V3版本，V4版本还在标准化当中，PKI是在X.509基础上发展起来的<br>
X.509标准的目的</p>
<ul>
<li>定义了一个使用X.500目录向用户提供认证服务的框架；每个证书包含了用户公钥，并由受信任证书颁发机构私钥签名</li>
</ul>
<p><strong>证书的表示</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329152633380-168835906033011.png" alt="image-20230329152633380" style="zoom: 67%;" />
<h3 id="CA">CA</h3>
<ul>
<li>作用：PKI核心实体是认证机构CA，为各个实体颁发电子证书，对实体身份信息和相应公钥数据进行<strong>数字签名</strong>，用以<strong>绑定该实体的公钥和身份</strong>，以证明各实体在网上身份的真实性；并负责在交易中检验和管理证书 ,<strong>同时也是CRL的签发者</strong></li>
<li>功能：
<ul>
<li>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230329153014263-168835906033012.png" alt="image-20230329153014263" style="zoom:67%;" />
</li>
</ul>
</li>
</ul>
<h1 id="Chapter3-IPSec：AH和ESP">Chapter3 IPSec：AH和ESP</h1>
<blockquote>
<p>AH提供认证，ESP提供加密或者认证&amp;加密。仅认证则选择AH，IKE的密钥管理协议在下一章</p>
</blockquote>
<table>
<thead>
<tr>
<th>def</th>
<th>exp</th>
</tr>
</thead>
<tbody>
<tr>
<td>IPSec协议</td>
<td>整体结构，AH&amp;ESP，IKE</td>
</tr>
<tr>
<td>SA：安全组合\关联</td>
<td>为使通信双方的认证/加密算法及其参数、密钥的一致，<strong>相互间建立的联系</strong></td>
</tr>
<tr>
<td>SPD：安全策略数据库</td>
<td>包含一个策略条目的有序表</td>
</tr>
<tr>
<td>SAD：安全关联数据库</td>
<td>包含现行的SA条目</td>
</tr>
<tr>
<td>SPI</td>
<td>目的端产生，则源端用SPI和目的端地址来标识，目的端只需要看SPI即可</td>
</tr>
<tr>
<td>单向性</td>
<td>在A到B的通信中，SA在两头都有，但是仅表示单向</td>
</tr>
</tbody>
</table>
<blockquote>
<p>IPSec<strong>优点</strong>：</p>
<ul>
<li>传统的计网没有考虑安全需求有安全隐患</li>
<li>对上层应用或者用户透明，在网络层建立了<strong>端到端</strong>保护的安全隧道（下面为需要实现的内容）
<ul>
<li><strong>保密</strong>对称加密，完整性HMAC，重放随机数和时间戳</li>
<li>IPSec仅端到端(点到点是IP分组进行寻路，需要在路由器上进行安全操作)</li>
</ul>
</li>
<li>可以构建可靠的<strong>虚拟专用网</strong></li>
<li>对<strong>边界所有流量</strong>强制实现安全性，内部网络无需关注开销</li>
</ul>
</blockquote>
<h3 id="IPV4和IPV6的头标">IPV4和IPV6的头标</h3>
<ul>
<li>
<p>IPV4 address：32bits</p>
</li>
<li>
<p>IPV6 address：128bits</p>
</li>
<li>
<p>IPv4报头一般不定（比如20B）</p>
</li>
<li>
<p>IPv6报头固定40B</p>
</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230410080714398-168835911227425.png" alt="image-20230410080714398"  />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230410075559310-168835911227426.png" alt="image-20230410075559310" style="zoom:67%;" />
<p>IPV6核心思想解决:</p>
<ul>
<li>地址空间不足：32-128</li>
<li>无类别域间寻址：一定程度上解决路由表急剧膨胀</li>
</ul>
<p>考点：</p>
<ul>
<li>MTU分段（段偏移8字节）</li>
<li>中间路径更大不重组，更小再次分段（相对位置为原始数据包）</li>
<li>删除校验和（Tcp已经做了，链路层也会做；网络可靠且想提高效率）</li>
<li>删除头部长度、选项填充、标识id、flag、段偏移但是会出现在分段扩展报头中</li>
<li>增加流标记域：优化原本的优先级域，仍不好</li>
<li>扩展报头（目的地址之后）：将删除可选项统一移动到扩展报头（除了逐跳选项）</li>
</ul>
<blockquote>
<p>tips：先AH再ESP后，加解密不会对AH的认证有影响。头标插入IP之后</p>
</blockquote>
<p><strong>顺序</strong>：首先加密-认证，再认证-解密，IPv6头标的顺序（pgp存储相反）</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230410082745310-168835911227527.png" alt="image-20230410082745310" style="zoom:67%;" />
<blockquote>
<p>两人对话之间<strong>建立安全通道</strong>：（不同方向、不同功能）</p>
<ul>
<li>两者协商参数和算法：HMAC参数，使用对称密钥还是非对称</li>
<li>密钥交换：DH种子密钥？</li>
<li>认证通信双方（三个来回）：数字证书</li>
<li>(防止重放：使用hash时间戳随机数或者定时器密钥更新)</li>
<li>需要确保通信链路安全，意味着通信双方与服务器和服务器之间的连接安全</li>
</ul>
</blockquote>
<blockquote>
<p>两人建立对话通道</p>
<ol>
<li>协商算法，协议，公共参数（IPsec多功能一起选，也有一些组合套餐选择）（DH或者数字信封协商参数）</li>
<li>双向认证，基本方法是挑战应答</li>
<li>DH密钥交换（防止重放攻击，中间人攻击）</li>
</ol>
<p>在建立会话通道之后，产生一个ISA，然后使用派生的方法对密钥进行派生，（随机数、现实时间等）</p>
<p>IPsec的预共享密钥是对等的，但是在服务器模型中是不对等的。在服务器的认证中，C对S发出请求，S会向AS核验等</p>
</blockquote>
<div class="note info flat"><p>SP-SPD：提前配置</p>
<p>SA-SAD：动态变化</p>
</div>
<h3 id="SA">SA</h3>
<blockquote>
<p>为使通信双方的认证/加密算法及其参数、密钥的一致，相互间建立的联系被称为安全组合或安全关联</p>
</blockquote>
<ul>
<li>不同方向可能存在不同的策略，SA是<strong>单向</strong>的，在双向通信时要建立两个SA。一主机，某会话的输入、出数据流处理需要两个独立的SA。
<ul>
<li><strong>同时需要AH和ESP需要有4个SA</strong></li>
</ul>
</li>
<li>SA是通过密钥管理协议（如IKE）在通信双方之间进行协商，协商完毕后，双方<strong>都在它们的安全关联数据库（SAD）中存储该SA参数。</strong></li>
<li>SA由一个<strong>三元组</strong>唯一地标识：【安全参数索引<strong>SPI</strong>，<strong>目的</strong>IP地址[输出处理]，协议[如AH或ESP]】</li>
<li><strong>SPI是为了唯一标识SA而生成的一个32位整数，由目的端确定，另一端可采用目的地址+SPI值标识该SA。</strong>，包含在AH/ESP头标中。SPI为同一个源与目的之间建立多个SA提供可能。
<ul>
<li>spi最终是要在目的端进行处理用于找SA的，所以最好是由目的端 产生统一管理所有想要发包到自己这里的SA，不然可能会重复，</li>
<li>且源端的安全参数可能会被篡改</li>
<li>有了SPI，相同源、目的节点的数据流可以建立多个SA。（√）</li>
</ul>
</li>
</ul>
<h3 id="安全策略数据库（SPD）"><strong>安全策略数据库（SPD）</strong></h3>
<p>SPD中包含一个策略条目的有序表，通过使用一个或多个选择符来确定每一个条目。</p>
<p>选择符可以是<strong>五元组（目的/源地址，协议，目的/源端口号）</strong>，或其中几个，理论上可以根据数据包的任何一个域来确定。条目中包含：</p>
<ul>
<li>策略（是否需要IPSec处理）：丢弃，绕过不使用IPSec，加载IPSec</li>
<li>SA规范</li>
<li>IPSec协议（AH/ESP）</li>
<li>算法</li>
<li>操作模式</li>
<li>对外出处理，应<strong>在SPD中查找指向SAD中SA的指针</strong></li>
</ul>
<blockquote>
<p>包进行策略匹配，找到SA指针，如果在SD中没有则使用IKE策略新增</p>
<p>IPsec协议提供了数据加密、身份验证和完整性保护等安全机制，而IKE协议则负责在IPsec通信<strong>开始之前协商和建立安全参数</strong>，它们共同构成了IPsec VPN（Virtual Private Network）的核心机制。</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230410091800722-168835911227528.png" alt="image-20230410091800722"></p>
<h3 id="安全关联数据库（SAD）">安全关联数据库（SAD）</h3>
<p>包含现行的SA条目，每个SA由三元组索引，一个SAD条目包含下面域：</p>
<ul>
<li>序列号计数器：32位整数，用于生成AH或ESP头中的序列号</li>
<li>序列号溢出：是一个标志，标识是否对序列号计数器的溢出进行审核。</li>
<li>抗重放窗口：使用一个<strong>32位计数器</strong>和位图确定一个输入的AH或ESP数据包是否是重放。【目的端检测重放】</li>
<li>AH/ESP所需的认证算法和密钥</li>
<li>ESP加密算法和IV</li>
<li>IPSec操作模式</li>
<li>SA生存期</li>
<li>路径最大传输单元（PMTU）</li>
</ul>
<h3 id="AH：认证头标">AH：认证头标</h3>
<p>AH协议：</p>
<ul>
<li>提供<strong>无连接的完整性</strong>（覆盖IP头标除可变域的部分）、<strong>数据源认证和抗重放保护服务</strong></li>
<li>不提供保密性服务。</li>
<li>AH使用消息认证码（MAC）对IP进行认证。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230410092422264-168835911227529.png" alt="image-20230410092422264"></p>
<blockquote>
<p>A-B，则由B来确定SPI则A就可以用SPI了</p>
<p>发送接收窗口，拥塞窗口，这里的序列号防止重放窗口</p>
<p>序列号：32位无符号证书抵抗重放攻击</p>
<p>认证数据：SHA256等基本上是32位整数倍</p>
</blockquote>
<ul>
<li>SKL的确定：参数协商-密钥交换MA-DH</li>
</ul>
<p>目的端只需要SPI值即可查找，如果是源端则需要SPI+目的端</p>
<p>目的端确定spi，则目的端</p>
<p>源端确定spi，则目的端需要同时知道源端和spi</p>
<p>SA三元组（spi，目的端，协议)，目的端确认SPI，源端使用三元组中的spi和目的端来标识SA</p>
<p>进入通道-离开节点</p>
<h3 id="AH处理">AH处理</h3>
<p><strong>源端</strong></p>
<ul>
<li>使用选择符（目的IP，端口，传输协议等）从SPD获取策略
<ul>
<li>SA已经建立，SPD将指向外出SA数据库（SAD）的一个或者多个SA</li>
<li>SA未建立，IPSec将调用<strong>IKE</strong>协商一个SA，并将其连接到SPD条目上</li>
</ul>
</li>
<li>产生或增加序列号，新的SA计数初始化为0</li>
<li>计算ICV</li>
<li>转发分组到目的节点</li>
</ul>
<p><strong>目的端</strong></p>
<ul>
<li>特殊：IP无IPsec选项，SPD查找策略，如果确实无IPsec则放行。</li>
<li>（SPI，目的IP，协议）找SAD中的SA</li>
<li>根据SA进行IPsec处理</li>
<li>序列号：重放？</li>
<li>SA指定的MAC算法计算ICV，比较认证数据域中的ICV</li>
</ul>
<p><strong>ICV计算</strong>：AH包含头（由于仅包含不变域和可预测，则需要将可变域置零），和后面的仅对数据（ESP载荷tcp头+数据+esp尾）的校验不同</p>
<ul>
<li>pMAC的计算包括<strong>IP</strong>头标，计算前先将可变域**置0，**不变域和可预测域保持不变。但在隧道模式下，内部IP头标的可变域不用设为0。</li>
<li>长度依赖于HMAC-MAC算法，HMAC-MD5是128，SHA1是160</li>
</ul>
<blockquote>
<p>AH使用HMAC</p>
<p>ESP使用对称加密，如果使用可选认证也是使用MAC</p>
</blockquote>
<p>注意：</p>
<ul>
<li><strong>如果特定使用ESP加密和认证，则只有一个SA同时存放了加密和认证的密钥。</strong></li>
<li>ab通信会调用4个SA，分别代表<strong>AH和ESP</strong>以及不同的方向，仅存储在不同方向，但是同一个东西</li>
<li>源端和目的端，通道出入的不同解释</li>
</ul>
<h3 id="Esp处理">Esp处理</h3>
<p><strong>组成</strong></p>
<ul>
<li>填充域：对齐，32位分组，防止攻击</li>
<li>填充长度</li>
<li>下一头标：表示紧跟在ESP头部后面的协议，其中值为6表示后面封装的是TCP</li>
<li><strong>认证数据</strong>：可变长字段，只有选择了认证服务时才需要有该字段（覆盖ESP头标和除了认证数据的数据部分，区别于AH，不包括IP头标）
<ul>
<li>认证的范围是ip头标之外的数据（esp+TCP+数据+esp尾标）</li>
</ul>
</li>
</ul>
<blockquote>
<p>多个SA的处理场景，SA树，同时使用SA和ESP的顺序</p>
</blockquote>
<h3 id="ESP处理">ESP处理</h3>
<p><strong>源端</strong></p>
<ul>
<li>使用分组的相应<strong>选择符</strong>（目的IP地址、端口、传输协议等）查找<strong>安全策略数据库</strong>（SPD）获取策略
<ul>
<li>有SA：则与选择符相匹配的SPD项将指向<strong>安全关联数据库</strong>（SAD）中的相应SA</li>
<li>否则则使用IKE建立SA</li>
</ul>
</li>
<li>生成或增加序列号</li>
<li>加密分组，SA指明加密算法，一般采用对称密码算法</li>
<li>完整性校验值即ICV(可选)</li>
</ul>
<p><strong>目的端进入处理</strong></p>
<ul>
<li>使用目的IP地址、IPSec协议、SPI进入SAD检索特定SA，如果查找失败，则丢弃分组</li>
<li>策略验证：使用分组的选择符进入SPD中查找与之匹配的策略，根据策略检查该分是否满足IPSec处理要求</li>
<li>检查抗重放功能</li>
<li>如SA指定需要认证，则检查数据完整性</li>
<li>解密</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230417080814009-168835911227530.png" alt="image-20230417080814009" style="zoom:67%;" />
<h3 id="总结">总结</h3>
<table>
<thead>
<tr>
<th>项目</th>
<th>认证头标AH</th>
<th>封装安全载荷ESP</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>无连接的数据完整性、数据源认证和抗重放保护服务</td>
<td>数据保密、无连接完整性（可选，不覆盖IP）、抗重放攻击</td>
</tr>
<tr>
<td>填充</td>
<td>-</td>
<td>需要：32位对齐；分组密码要求长度是某个长度的整数倍；抗流量分析</td>
</tr>
<tr>
<td></td>
<td>使用MAC源认证，包括IP头标，计算前先将可变域置0，不变域和可预测域保持不变（隧道模式不用置零）</td>
<td></td>
</tr>
<tr>
<td></td>
<td>防止重放：序列号+固定窗口</td>
<td></td>
</tr>
<tr>
<td>认证范围</td>
<td>整个IP包除了IP头中可变的部分</td>
<td>不包括IP头标</td>
</tr>
<tr>
<td>加密范围</td>
<td>不提供保密性服务</td>
<td>加密范围包括除了IP头标和ESP头标的部分</td>
</tr>
</tbody>
</table>
<ol>
<li>源端：</li>
</ol>
<ul>
<li>从 IP 数据包头部获取目的 IP 地址；</li>
<li>在 SPD 中查找到达目的 IP 地址所需的 SAD 条目；</li>
<li>根据 SAD 条目生成序列号，并将序列号与待加密的明文一起输入到加密算法中，生成加密后的密文；</li>
<li>计算 ICV 值（即完整性检查值），将 ICV 值添加到加密后的密文中，形成 IPsec 报文；</li>
<li>将 IPsec 报文发送给下一跳。</li>
</ul>
<ol>
<li>目的端：</li>
</ol>
<ul>
<li>接收 IPsec 报文；</li>
<li>检查 IPsec 报文头部中的 SPI 值，根据 SPI 值查找到相应的 SAD 条目；</li>
<li>检查序列号是否重放；</li>
<li>将密文和 ICV 值分离出来，并通过解密算法得到明文；</li>
<li>计算接收到的 ICV 值，并将计算得到的 ICV 值与报文中的 ICV 值进行比较，以验证报文的完整性。</li>
</ul>
<h3 id="传输模式和隧道模式">传输模式和隧道模式</h3>
<blockquote>
<p>在新的IP包加上IP头 和AH和ESP，进行认证加密</p>
</blockquote>
<p><strong>传输模式</strong>：AH和ESP头标被插在IP头标及其他选项（或扩展头标）<strong>之后</strong>，但在传输层协议之前。它保护净荷的<strong>完整性和机密性</strong>。<br>
<strong>隧道模式</strong>：AH或ESP头标插在IP头标<strong>之前</strong>，另外生成一个<strong>新的IP头</strong>放在前面，隧道的<strong>起点和终点的网关地址</strong>就是新IP头的源/目的IP地址，保护整个IP分组</p>
<blockquote>
<p>净荷可以看成头标有效的域范围，用户数据：净荷，ESP所处理的：ESP净荷=TCP+用户数据，也就是ESP头标和尾标之间的部分，另外认证数据是可选的，不包括在加密认证内部。</p>
<p>AH认证all除了特定的ip头</p>
<p>ESP加密ESP净荷，认证包括ESP的头的ESP净荷</p>
<p>ESP净荷是TCP+用户数据</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230419114025890-168835911227531.png" alt="image-20230419114025890" style="zoom:67%;" />
<ul>
<li>对两个位置（边缘网关）建立安全通道之后，认可来的数据，则此时不需要web vpn访问</li>
<li>但是如果不能肯定使用的用户身份，或者建立通道复杂，可能较麻烦</li>
<li>虚拟链路构建了虚拟的专用网，即逻辑上统一的网络，在后面VPN的时候详解</li>
</ul>
<blockquote>
<p>授权树</p>
</blockquote>
<h3 id="IPSec-VPN">IPSec VPN</h3>
<blockquote>
<p>可能两地太远，专用光纤链路太贵（但是能够实现专用的高速下载），可能使用VPN替代。</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230419114342917-168835911227532.png" alt="image-20230419114342917" style="zoom: 80%;" />
<h3 id="IPSec与NAT">IPSec与NAT</h3>
<p>NATPT通常在防火墙或网关上实现，对过往的IP地址、端口号进行转换。具有AH头标或ESP头标的的IP分组不能穿越NAT和NATPT。原因：</p>
<ul>
<li>地址的修改使得接收端的AH认证失败</li>
<li>上层端口号信息的ESP加密，使得端口无法被得知，无法进行NAT-PT</li>
<li>上层TCP/UDP中校验和计算涉及伪头标，包括IP地址和端口，通过ESP认证，校验和字段不能被修改，上层会校验验证失败</li>
<li>针对ESP问题，IETF的解决方案：在ESP头标前插入一个UDP头标</li>
</ul>
<blockquote>
<p>IPsec和NAT的冲突解决，有个草案是</p>
</blockquote>
<blockquote>
<p>AS和ESP同时使用，AB建立标准的安全通道，即完整性和保密性时：需要有4个SA</p>
</blockquote>
<blockquote>
<p>SA概念，三元组，三个概念AH和ESP的功能和范围，实现原理</p>
<p>源端目的端处理，两个工作模式，IPsec和NAT的冲突，和VPN的关系</p>
</blockquote>
<p>这里需要注意的是AH认证范围包括了IP头所以无法验证，ESP加密和认证都不包括IP头但是上层的TCP会受影响</p>
<h1 id="Chapter-4-IKE">Chapter 4 IKE</h1>
<h1 id="Chapter-4">Chapter 4</h1>
<h2 id="IKE（因特网密钥交换协议）">IKE（因特网密钥交换协议）</h2>
<p>IKE：因特网密钥交换协议，是一个以受保护的方式动态协商IPsec SA的协议。功能：使用某种长期密钥（共享秘密密钥、只用于签名的密钥、用于加密的密钥）进行双向认证并建立会话密钥</p>
<p><strong>IKE：基于长期密钥协商得到短期密钥</strong></p>
<blockquote>
<p>开销：非对称100，对称1，hash0.01，异或更小</p>
<p>IKE：比如DH交换密钥SA，然后再规定从SA派生的密钥，分成两个阶段的灵活性导致协议会更加复杂</p>
</blockquote>
<p><strong>IPsec的体系结构</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="D:/A_blog/source/_posts/assets/image-20230419145047375.png" alt="image-20230419145047375" style="zoom: 43%;" />
<h3 id="IKEv1">IKEv1</h3>
<p>使用了<strong>ISAKMP框架</strong>，希望独立于具体的密钥协商算法，部分使用了<strong>Oakley协议和SKEME协议</strong></p>
<blockquote>
<p><strong>ISAKMP</strong>协议：密钥管理架构，定义SA的建立、协商、修改、删除规程和分组格式；<strong>独立于密钥交换协议、加密算法和认证方法</strong>，下层由UDP协议承载，端口号为500。</p>
</blockquote>
<blockquote>
<p>SSL3.0和TLS1.3，防止SSL2的降级攻击</p>
</blockquote>
<p>两个阶段：第一阶段用于协商通信的安全密钥，需要进行DH密钥交换等非对称密码，开销较大</p>
<ul>
<li>
<p>第一阶段：p建立ISAKMP SA（安全通道）</p>
<blockquote>
<p>为建立IKE本身使用的安全信道而相互交换SA（采用ISAKMP）——ISAKMP <strong>SA</strong>（双向）</p>
</blockquote>
<ul>
<li>步骤（交换3、6个报文）：需要将步骤耦合起来
<ul>
<li>安全参数协商</li>
<li>DH密钥交换</li>
<li>实体认证</li>
</ul>
</li>
<li>交换模式：
<ul>
<li>主模式：IKE中必须要配置主模式，身份的挑战应答AB均要互相证明身份，需要协商</li>
<li>野蛮模式：不需要协商，简化规程，提高处理过程</li>
</ul>
</li>
<li>认证方式：预先共享密钥、数字签名、公钥加密（加/解密四次）、修订的公钥加密</li>
</ul>
</li>
</ul>
<blockquote>
<p>结束后是3+3或者6+3的结果</p>
</blockquote>
<ul>
<li>
<p>第二阶段：建立IPSec SA，一个第1阶段的SA可以用于建立多个第2阶段的SA</p>
<blockquote>
<p>利用第一阶段建立的安全信道交换IPSec通信中使用的SA——IPSec SA（单向）</p>
</blockquote>
<ul>
<li>步骤（交换3个报文）
<ul>
<li>安全参数协商</li>
<li>可选的DH密钥交换</li>
<li>可选的实体认证</li>
</ul>
</li>
<li>快速模式（3报文交换）</li>
</ul>
</li>
</ul>
<blockquote>
<p>如果B仅是ip地址变了，那么sa无法再用，则需要额外进行整个过程。对用户的移动性管理，比如漫游机制就是一个映射机制</p>
</blockquote>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230506144013523-168838323021644.png" alt="image-20230506144013523" style="zoom: 67%;" />
<p><strong>主模式</strong>：</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230506141814230-168838323021543.png" alt="image-20230506141814230" style="zoom:67%;" />
<p><strong>野蛮模式</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230506141827508-168838323021645.png" alt="image-20230506141827508" style="zoom: 67%;" />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230506141041687-168838323021646.png" alt="image-20230506141041687" style="zoom:67%;" />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230506141609972-168838323021647.png" alt="image-20230506141609972" style="zoom:80%;" />
<p>IKEv1</p>
<ul>
<li>
<p>第一阶段：需要完整的过程而不是截拼凑</p>
<ul>
<li>协商算法参数（选项或者给定选择接收或者拒绝）</li>
<li>DH密钥交换</li>
<li>认证</li>
</ul>
<blockquote>
<p>3+3或者6+3（通常），前面的3可能是多个</p>
</blockquote>
</li>
<li>
<p>第二阶段：有了SKYid的密钥参数</p>
<ul>
<li>-e：加密</li>
<li>-a：完整性保护</li>
<li>需要bfss：需要DH交换参数(gir)</li>
</ul>
<blockquote>
<p>4个sa则调用4次第二阶段</p>
</blockquote>
</li>
</ul>
<p><strong>KE</strong>载荷</p>
<ul>
<li>通用头：每一个IKE载荷的开始，它定义了载荷的边界，所以可以连接不同的载荷。</li>
<li>SA载荷：用于协商SA所的相关属性，实际上是一个嵌套的层次结构。1个SA载荷包含1个或者多个</li>
<li>P载荷，1个P载荷包含1个或者多个T载荷</li>
<li>P载荷：包括SA协商中需要的信息，协商的协议（AH/ESP）</li>
<li>T载荷：定义特定协议中使用的密码算法</li>
<li>密钥交换载荷：用于传输DH密钥交换中的报文</li>
<li>标识载荷：用于通信双方交换身份信息</li>
<li>认证载荷：包含了用于认证的数据，目前定义的认证方式包括RSA数字签名、消息认证码、DSS数字签名。</li>
<li>现时载荷nonce：分别提供，包括用于保证交换及时性的随机数据，用来阻止重复攻击</li>
</ul>
<p><strong>密钥推导</strong>：</p>
<ul>
<li>
<p>SKEYID：一个衍生自仅有通信双方知道的秘密密钥信息的密钥串。</p>
</li>
<li>
<p>SKEYIDe：ISAKMP用来保护它的消息保密性的密钥信息</p>
</li>
<li>
<p>SKEYIDa：ISAKMP用来认证它的消息的密钥信息</p>
</li>
<li>
<p>SKEYIDd：用来在第二阶段协商中为非ISAKMP SA生成密钥的密钥信息</p>
<p>后三个密钥都是通过SKEYID和其他信息（发起响应者的cookie等）利用随机数算法派生得到。</p>
</li>
</ul>
<blockquote>
<p>书上有部分内容错误，IKE SA的那个名称大概还是用的IKE1</p>
</blockquote>
<blockquote>
<p>挑战应答：a-b，b-a两对四次消息，可将中间两个合并</p>
</blockquote>
<h3 id="IKV2">IKV2</h3>
<p>出现原因</p>
<ul>
<li>NAT穿越：用了NAT设备的私有TCP/IP网络中的主机之间建立连接的问题。</li>
<li>EAP中的legacy authentication</li>
</ul>
<h1 id="Chapter-5-SSL-TLS基本协议">Chapter 5 SSL/TLS基本协议</h1>
<blockquote>
<p>P139 主版本号：2048压缩啥的成为16bit而不是8bit</p>
<p>P143：l4，会话重用，客户端非零在另外一段相同值则启用了会话重用，反之会发起新的会话</p>
</blockquote>
<p>SSL协议簇：TCP协议上为两个端实体提供安全通道</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703143447264.png" alt="image-20230703143447264" style="zoom:50%;" />
<blockquote>
<p>IPsec是网络层协议，在不依靠IPsec时候需要依靠端到端的上层安全协议提供保护。SSL/TLS把数据分割为带有报头和安全保护的记录信息，为应用程序提供可靠的、加密的、完整性保护的数据流记录。</p>
</blockquote>
<p>SSL解决的问题：</p>
<ul>
<li><strong>客户对服务器的认证</strong>：SSL服务器允许客户的浏览器使用标准的公钥加密技术和一些可靠的认证中心（CA）的证书，来确认服务器的合法性。</li>
<li><strong>服务器对客户的认证</strong>：公钥+证书/用户名+口令</li>
<li><strong>建立服务器与客户之间安全的数据通道</strong>：SSL要求客户与服务器之间的所有发送的数据都被发送端加密、接收端解密，同时还检查数据的完整性</li>
</ul>
<p>SSL提供的服务：</p>
<ul>
<li>用户和服务器的<strong>合法性认证</strong>：X.509数字证书</li>
<li>传输数据<strong>机密</strong>性：DES, 3DES, RC2, RC4, IDEA…</li>
<li>传输数据<strong>完整</strong>性：MAC-MD5, MAC-SHA1…</li>
</ul>
<blockquote>
<p>在流数据的加密用rc4，虽然不安全但是能这么做</p>
</blockquote>
<h3 id="SSL相关">SSL相关</h3>
<ul>
<li>基本描述：在tcp协议上为两个端实体提供安全通道的协议</li>
<li>基本层次结构：记录协议，握手、密码、警告、用户数据</li>
<li>安全服务：用户（可选，在标准的ssl外有用户认证即身份密码）和服务器认证（必须有网站证书），数据机密完整</li>
<li>握手协议：<strong>用于在客户与服务器之间建立安全连接之前交换安全信息</strong>
<ul>
<li>客户对服务器的认证，与服务器对客户的认证（可选）</li>
<li>协商加密算法和密钥</li>
<li>协商的密钥是安全的（中间人不知道），协商本身是可靠的</li>
<li>认证、协商算法密钥、身份认证加共享密钥安全，可靠抗重放抗截拼</li>
<li>会话重用
<ul>
<li>同意会话重用</li>
<li>不同意</li>
</ul>
</li>
</ul>
</li>
<li>改变密码规格协议：告知改变密码参数</li>
<li>告警协议：向对端指示安全错误</li>
<li>记录协议：
<ul>
<li>建立在TCP可靠传输服务商</li>
<li>提供保密性（对称加密），完整性（HMAC），身份认证</li>
<li>SSL记录协议保护方式：分段 -&gt; 压缩 -&gt; 添加MAC值（对压缩以后的数据完整性保护）-&gt; 加密 -&gt; 加记录协议头</li>
</ul>
</li>
</ul>
<p><strong>SSL握手协议</strong></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703144625694.png" alt="image-20230703144625694" style="zoom:67%;" />
<p><strong>会话重用</strong></p>
<ul>
<li>SSL/TLS认为<strong>会话通常是具有较长的生命期</strong>，在此之上需要在会话基础上容易派生出多个连接。这是因为协议被设计为<strong>能够与HTTP协议协同</strong>工作，而HTTP协议能够在相同客户和服务器之间打开大量的TCP连接
<ul>
<li>会话：客户与服务器的关联，由握手协议创建。会话定义一组安全参数，可以在多个连接之间共享。避免每次连接都进行昂贵的参数协商</li>
<li>连接：提供适当类型服务的传输，连接是暂时的，每个连接都与一个会话相关联</li>
</ul>
</li>
<li>通过发送包括nonce握手消息的方式，能够在主密钥的基础上派生出多个连接中使用的相关密钥。</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703144509114.png" alt="image-20230703144509114" style="zoom:67%;" />
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703144520548.png" alt="image-20230703144520548" style="zoom:67%;" />
<p><strong>密钥计算</strong></p>
<ul>
<li>
<p>秘密值S：预主密钥</p>
</li>
<li>
<p>主密钥（Master secret）K：K=f（S，Ra，Rb）</p>
</li>
<li>
<p>对于每个连接，每个方向上各三个密钥，分别为<strong>加密</strong>密钥、<strong>完整性保护</strong>密钥、<strong>IV</strong>：gi（ K，Ra，Rb ），<strong>一共6个</strong></p>
</li>
<li>
<p>KDF：密钥派生函数，加密散列函数。这里使用MD5（128）和SHA-1（160）</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703145035506.png" alt="image-20230703145035506" style="zoom: 67%;" />
</li>
</ul>
<p><strong>第一阶段</strong>：建立安全协商</p>
<blockquote>
<p>这里的随机数一开始是用32位时间戳和28字节的随机序列，后面改回32随机数因为前面用时间避免随机数重复的可能性很低</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230510142813559-168835915142641.png" alt="image-20230510142813559"></p>
<p><strong>第二阶段</strong>：</p>
<blockquote>
<p>不能将操作分开</p>
</blockquote>
<h3 id="密钥交换算法">密钥交换算法</h3>
<p>两类密钥交换算法</p>
<ul>
<li><strong>RSA</strong>，客户产生一个<strong>48</strong>字节的<strong>pre_master_secret</strong>，然后通过服务器的公钥传递给服务器</li>
<li><strong>Diffie-Hellman</strong>，双方协商得到的密钥被用作<strong>pre_master_secret</strong>（包括固定、暂态、匿名三种）</li>
<li><strong>master_secret</strong>总是48字节长，<strong>pre_master_secret</strong>长度不定</li>
</ul>
<blockquote>
<p>一般来说的密钥交换会更想要DH，不同的安全性是独立的</p>
</blockquote>
<p>AB建立会话通道</p>
<ul>
<li>标准协商，包括密码算法，是否选择</li>
<li>DH密钥交换</li>
<li>因为DH可能有中间人攻击，故进行身份认证，</li>
</ul>
<blockquote>
<p>这里一共是有三组来回，但是DH的后一步可以与挑战的前一步合并。</p>
</blockquote>
<h3 id="SSL协议的安全性分析">SSL协议的安全性分析</h3>
<p>SSL协议采用的加密和认证算法</p>
<ul>
<li>加密算法与会话密钥：算法有RC4，RC2，IDEA和DES；密钥由消息散列函数MD5、SHA-1产生</li>
<li>认证算法：采用X.509证书</li>
</ul>
<p><strong>安全优势</strong>：</p>
<ul>
<li>监听和中间人攻击（√）</li>
<li>流量数据分析攻击（x）<strong>TLS可以抵抗此类攻击</strong></li>
<li>截拼攻击（√）</li>
<li>重发攻击（√）</li>
<li>密码回滚攻击CipherSuiteRollback attack （√）:SSL3.0中新加的功能，可以防止对密码学算法协商过程的更改问题：</li>
</ul>
<p><strong>问题</strong></p>
<ul>
<li>密钥管理问题：许多实现，服务器的证书不是基于可信的CA颁发</li>
<li>加密强度问题：低比特位数的加密算法(出口限制)</li>
<li>数字签名问题：没有数字签名，不能抗抵赖</li>
</ul>
<blockquote>
<p>只要是涉及密钥参数协商的主要就是用DH密钥交换和RSA的数字信封</p>
</blockquote>
<h1 id="Chapter-6：防火墙和NAT">Chapter 6：防火墙和NAT</h1>
<p>防火墙：位于两个或多个网络之间，实现网间访问控制的组件集合（软件+硬件+控制策略）【访问控制、加密、地址翻译、VPN、负载均衡等】</p>
<ul>
<li>内外部所有数据流经过</li>
<li>符合安全政策的数据流流出</li>
<li>自身抗攻击</li>
</ul>
<p>包过滤防火墙</p>
<ul>
<li>网络层的访问控制机制</li>
<li>对所有<strong>进入的包</strong>进行安全检查【五元组，源目标ip，ip协议域，端口号】。</li>
<li>首先建立一些规则，如果没有和建立好的规则自上而下匹配则执行缺省策略（一切未被禁止的就是允许的、一切未被允许的就是禁止的）</li>
<li>优点：
<ul>
<li>简单透明效率高</li>
</ul>
</li>
<li>缺点：
<ul>
<li>规则制定难，无认证机制，无连接状态信息</li>
<li>对应用层数据无法处理</li>
<li>纯粹的包过滤防火墙适合单连接服务比如smtp，pop3，不适合多连接比如ftp</li>
</ul>
</li>
</ul>
<p><strong>状态检测防火墙</strong></p>
<p>建立一个<strong>出网的TCP连接目录</strong>而加强TCP数据流的检测规则。报文过滤机制只允许那些和目录中某个连接匹配的数据流通过防火墙。</p>
<p>例题：分析<strong>FTP主动模式</strong>和被动模式下，状态检测型防火墙的过滤策略和处理流程</p>
<ul>
<li>主动
<ul>
<li><strong>防火墙配置</strong>：允许从<strong>内部网络发往外部网络</strong>的<strong>源端口20</strong>的TCP连接，以及从外<strong>部网络发往内部网络的目的端口21和源端口N的TCP连接</strong>（N是客户端指定的端口号。允许合法命令通过，并控制连接状态。</li>
<li>流程：当客户端发送一个<strong>PORT命令</strong>指定数据连接的端口号N时，防火墙会检查该命令并允许通过。随后，当<strong>服务器向客户端的端口N</strong>发起数据连接时，防火墙会允许该连接通过，并记录数据连接的状态。防火墙会维护与FTP会话相关的状态信息，以便正确地处理数据连接。</li>
</ul>
</li>
<li>被动
<ul>
<li><strong>防火墙配置</strong>：允许从<strong>外部网络发往内部网络</strong>的目的端口为<strong>21和大于1023</strong>的TCP连接。允许合法命令通过，并控制连接状态。</li>
<li>流程：当客户端发送一个<strong>PASV命令</strong>时，服务器会在一个动态指定的端口上开放由客户端连接的<strong>端口N</strong>，随后<strong>通过客户端的连接请求</strong>，并记录相关信息</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>
<p>应用级网关型防火墙<br>
在应用层上建立协议过滤和转发功能。即<strong>包过滤 + 应用层协议信息</strong>。因此可以实现基于内容的安全</p>
</li>
<li>
<p>代理服务器防火墙<br>
代理服务(Proxy Service)也称<strong>电路级网关或TCP通道</strong>。其特点是将所有跨越防火墙的网络通信分为两段。防火墙内外计算机系统间应用层的“链接”，由两个终止代理服务器上的 “链接”来实现，外部计算机的网络链路只能到达代理服务器，从而起到了<strong>隔离防火墙内外计算机系统的作用</strong>。</p>
</li>
<li>
<p>复合型防火墙</p>
<ul>
<li>
<p>屏蔽路由器结构</p>
<ul>
<li>简单的包过滤功能  、投资小配质检单，ACL多的时候影响性能</li>
<li>内部主机安全性好，对性能、可靠性要求比较高的环境</li>
</ul>
</li>
<li>
<p>屏蔽主机结构</p>
<ul>
<li>单宿主主机</li>
<li>双宿主主机</li>
</ul>
</li>
<li>
<p>屏蔽子网结构</p>
<ul>
<li>DMZ停火区：两个包过滤器，内外网络之间创建新的子网，可能质保函堡垒主机，或者信息服务器。放置DNS,WEB,Email，FTP等</li>
<li>外部路由器仅允许对DMZ访问，拒绝内部网址为目的地址的包</li>
<li>内部路由器拒绝外部连接，仅允许对外访问（通过堡垒主机），特定条件下允许堡垒主机访问</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703150708943.png" alt="image-20230703150708943" style="zoom:67%;" />
</li>
<li>
<p>双热设备</p>
<ul>
<li>稳定性，一个防火墙完蛋了另一个马上顶上</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>内部防火墙和内部防火墙区别</strong></p>
<ul>
<li>外部防火墙位于本地或者内部网络边缘，刚好位于连接到互联网或者某些广域网的边界路由器内</li>
<li>内部防火墙保护企业内部网络，监控网络流量以识别不良行为和潜在威胁，保护网络免受越过边界的攻击</li>
</ul>
<p>例题：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703153043430.png" alt="image-20230703153043430" style="zoom:80%;" /></p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703153059072.png" alt="image-20230703153059072" style="zoom:80%;" />
<ul>
<li>AB允许入站SMTP连接，CD允许出站，E是defalt</li>
<li>（c）中攻击可能成功，因为BD允许两端使用1023以上端口的所有连接，即先匹配D再匹配B。增加限制将源端口限制为25而不是5150。此时（b）中四个包仍可以放行。</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703154044811.png" alt="image-20230703154044811"></p>
<p>例题：<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703154836853.png" alt="image-20230703154836853"></p>
<ul>
<li>D和C</li>
<li>这里设置BD<strong>不是首个连接的报文</strong>，BD需要为true（ACK set），此时只能先C再D</li>
</ul>
<h1 id="NAT">NAT</h1>
<blockquote>
<p>Tips</p>
<ul>
<li>新设备加入网络，主动广播mac和IP（ARP过程），本机建立对照表维护，在需要发送对应IP主机时表内查询或广播查询设备的mac地址。</li>
<li>子网掩码用于确认目标和本机是否在同一网段，不同网段需要将查询数据包发送给默认网关IP路由代发。</li>
</ul>
</blockquote>
<ul>
<li>
<p>源网络地址转换(SNAT，即IP伪装)：<strong>复用内部的全局地址</strong>，解缓IP地址不足的压力。同时可以向外部隐藏内部  【客户端】</p>
<ul>
<li>对于<strong>传出数据包</strong>，源IP地址(专用地址)被映射到ISP分配的地址(公用地址)，并且TCP/UDP端口号也会被映射到不同的TCP/UDP端口号，建立<strong>映射表信息</strong>。</li>
<li>对于<strong>传入数据包</strong>，根据映射表信息，目标IP地址(公用地址)被映射到源Internet地址(专用地址)，并且TCP/UDP端口号被重新映射回源TCP/UDP端口号。</li>
</ul>
</li>
<li>
<p>目的网络地址转换(DNAT)：在实现SNAT的环境下进行有效的服务访问，以及流量均衡【内网为服务器端】</p>
<ul>
<li>对于<strong>传入数据包</strong>，根据映射表信息，目的公用地址被映射到私有地址，并且TCP/UDP端口号被重新映射到不同TCP/UDP端口号。</li>
<li>对于<strong>传出数据包</strong>：源IP地址(专用地址)被映射到ISP分配的地址(公用地址)，并且TCP/UDP端口号也会被映射到不同的TCP/UDP端口号，建立<strong>映射表信息</strong>。</li>
</ul>
</li>
</ul>
<p>实现方式</p>
<ul>
<li>静态NAT（static NAT）：内部网络地址与NAT地址和端口号一一对应</li>
<li>动态NAT（Dynamic NAT）：多对多</li>
<li>NAT-PT：过载：一对多</li>
</ul>
<p>目的地址：pre 主力denat</p>
<p>源地址转化：post</p>
<p>处理的条目规则在这两处，但是实际上还是有动态处理</p>
<p>参数协商</p>
<p>DH密钥交换</p>
<ul>
<li>这里不用数字信封，而是使用一种动态协商的过程</li>
<li>交换的会话密钥结合参数的衍生得到多个密钥进行加密和完整性保护</li>
<li>加密是会话密钥，完整性保护就数字签名，因为需要多次文件传输</li>
</ul>
<p>身份认证</p>
<blockquote>
<p>要从仅有预共享密钥，到完整性和认证密钥。</p>
</blockquote>
<blockquote>
<p>要么是长期的预共享密钥，要么是非对称</p>
</blockquote>
<h1 id="Chapter-7-VPN">Chapter 7 VPN</h1>
<h3 id="VPN概述">VPN概述</h3>
<ul>
<li>实现<strong>不同网络</strong>的组件和资源相互连接，利用公众网络的基础设施为用户创建隧道，并提供专用网络（端到端物理链路）一样的<strong>安全和功能保障</strong></li>
<li>利用<strong>隧道技术</strong>在公共数据网络中虚拟出点到点的专线技术。【加解密技术、密钥管理、认证、访问控制技术】</li>
</ul>
<h3 id="VPN-分类">VPN 分类</h3>
<p>隧道技术：利用隧道协议对隧道两端数据<strong>封装和加密</strong>。</p>
<blockquote>
<p>隧道协议：一种网络层协议，在数据包中封装使用<strong>不同网络层协议</strong>的另一个完整数据包，本质上在网络上两点建立隧道，安全传输所有数据。</p>
</blockquote>
<ul>
<li>按照隧道协议分类
<ul>
<li>二层隧道协议：网络协议封装到PPP（数据链路层，传输帧）中，再装入隧道协议，保密性不高，可扩展性差
<ul>
<li>PPTP 【远程】【最易】：扩展GRE</li>
<li>L2TP【远程】：格式基于L2F，信令基于PPTP</li>
<li>L2F【远程】：基于ISP的若干远程接入服务器</li>
<li>L2</li>
<li>TP</li>
</ul>
</li>
<li>三层（LAN间、远程）
<ul>
<li>IPsec：隧道模式可以用于VPN构建，加密认证安全</li>
<li>MPLS：QoS（服务质量）保障，核心网络支持</li>
</ul>
</li>
<li>四层
<ul>
<li>SSL VPN：无需专门的客户端，只要支持web访问即可，与操作系统无关，穿越防火墙和NAT</li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>一般连接互联网是ISP进行IP地址的跟踪，记录流量，窃取数据。</p>
<p>而使用VPN会通过配置VPN服务器（数据来源）使得网络重定向IP，构建虚拟隧道，隐藏IP和上网数据（加密）。此时VPN服务器实际充当了网络代理，实际位置被隐藏，可访问的区域被扩展（VPN的位置欺骗，翻墙）。</p>
<p>另外，公司专网（服务器）使用VPN连接，可以保护数据。</p>
</blockquote>
<h3 id="IPsec协议">IPsec协议</h3>
<p>IPsec包括协议包：</p>
<ul>
<li>AH协议：信息<strong>源</strong>验证和完整性保证；</li>
<li>ESP 协议：供信息源认证、<strong>机密性</strong>和完整性保证；</li>
<li>IKE ：提供密钥协商（IKE v1、IKE v2)</li>
</ul>
<p>IPsec VPN：</p>
<ul>
<li>LAN间VPN【<strong>隧道模式</strong>】，提供安全网络传输【完整性、加密】</li>
<li>IKE支持<strong>动态密钥交换</strong>，采用<strong>预共享密钥</strong>或<strong>公钥机制</strong>认证身份，协商加密、认证密钥</li>
</ul>
<blockquote>
<p>VPN专用设备，嵌入防火墙路由器，或者动态IP地址的IPsec VPN（动态域名服务器）</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703114712667.png" alt="image-20230703114712667"></p>
<h1 id="Chapter-8-应用层安全协议">Chapter 8 应用层安全协议</h1>
<h2 id="PGP">PGP</h2>
<p>电子邮件安全需求</p>
<ul>
<li><strong>机密性</strong>：仅接收者阅读所以加密，关键是密钥分发，对应数字信封</li>
<li><strong>认证</strong>（发送者的身份认证）：私钥签名或者基于共享密钥的MAC</li>
<li>完整性：一般HASH就可以，加上认证可能需要HMAC或者<strong>哈希+数字签名</strong></li>
<li>抗否认性：私钥签名</li>
</ul>
<p>安全业务（无协商）</p>
<ul>
<li><strong>机密性</strong>：发信人产生一次性<strong>随机</strong>会话密钥，以IDEA、3-DES或CAST-128算法<strong>对称加密</strong>报文，RSA<strong>数字信封</strong>，并和消息一起送出。</li>
<li><strong>认证</strong>：用<strong>SHA-1</strong>对报文杂凑，并以发信人的<strong>私钥签字</strong>，签名算法采用RSA或DSS 。</li>
<li><strong>压缩</strong>：<strong>ZIP</strong>，用于消息的传送或存储。
<ul>
<li>签名-压缩-加密。
<ul>
<li>保存明文和签名更加方便，验证时不涉及会话密钥，故<strong>先认证后加密</strong></li>
<li><strong>签名-压缩</strong>：保存明文和签名方便，否则压缩后还要存储压缩结果和签名，且压缩结果可能不同导致认证失败。（签名是直接对应明文）</li>
<li><strong>压缩-加密</strong>：减少存储空间，减少加密开销，关联性降低使得密码分析困难</li>
</ul>
</li>
</ul>
</li>
<li>兼容性：由于历史原因，Email只被允许传送ASCII字符。采用<strong>Radix-64</strong>可将加密的报文转换成ASCII字符，将原报文扩展了33%
<ul>
<li>非ASCII也进行<code>3*8</code>bits转化为<code>4*6</code>bits，查找基-64表，对应ASCII，首位置零</li>
<li>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703120935442.png" alt="image-20230703120935442" style="zoom: 50%;" />
</li>
</ul>
</li>
<li>数据分段：PGP具有分段和组装功能，适应最大消息长度限制 50000字节</li>
</ul>
<p><strong>加密密钥和密钥环</strong> ：</p>
<ul>
<li>四种类型：一次性会话对称密钥【不可预测】，公钥，私钥，基于对称密钥的口令</li>
<li><strong>标识</strong>具体密钥
<ul>
<li>将公钥与消息一起传送</li>
<li>两个keyID包含在任何PGP消息中提供保密和认证功能</li>
<li>将一个标识符（<strong>KeyID</strong> = KUa mod 2^64，<strong>公钥的低64位</strong>）与一个公钥关联，对一个用户来说做到<strong>标识符和公钥</strong>一一对应</li>
</ul>
</li>
<li>每个PGP在每一个节点上提供一对数据结构
<ul>
<li>存储该节点拥有的公钥/私钥对私钥环（口令保护密钥）</li>
<li>存储本节点知道的其他用户的公钥环</li>
</ul>
</li>
</ul>
<p><strong>公钥</strong>：公钥密码体系，但不是证书。如何保证公钥是合法的？</p>
<ul>
<li>直接索取，其他方式确认</li>
<li>从可信任证书机构获得B的公钥</li>
<li>采用信任关系保护（从可信第三方）公钥</li>
</ul>
<blockquote>
<p>属于电子邮件安全协议的有 S/MIME【商，X509】，PEM，PGP，SMTP【禁二进制、7位ascii字符，无中文，超长邮件拒绝等】</p>
</blockquote>
<blockquote>
<p>MIME：签名加密or组合保证通信安全，强化了证书规范</p>
<p>封装数据是加密内容和加密的会话秘钥，签名</p>
</blockquote>
<blockquote>
<p>SSH体系框架：</p>
<ul>
<li>SSH传输层(Transport Layer)协议：提供服务器主机认证，提供数据加密，提供数据完整性支持</li>
<li>SSH认证(Authentication)协议：为服务器提供用户的身份认证</li>
<li>SSH连接（Connection）协议：将加密的信息隧道复用成若干个逻辑通道，提供给高层的应用协议使用。</li>
</ul>
<p>HTTPS（http over SSL）</p>
<ul>
<li>由http和SSL结合来实现浏览器和服务器之间的安全通信</li>
<li>https的功能被嵌入到所有当前的主流浏览器当中，但依赖于服务器端是否支持https通信</li>
<li>https的周知端口为443，http为80</li>
<li>当使用HTTPS时以下内容被加密：请求文件的URL、文件内容、浏览器表单内容、cookie、http头标内容</li>
<li>连接建立：TLS握手，然后是标准的http过程。一个会话有多个连接</li>
<li>连接关闭：<strong>先关http再关SSL，TCP</strong></li>
</ul>
</blockquote>
<h2 id="SET：消费者，商家（OI），银行（PI）">SET：消费者，商家（OI），银行（PI）</h2>
<blockquote>
<p>网上交易数据的保密性，数据的完整性以及交易的不可抵赖性 。目前公认的信用卡/借记卡网上交易安全标准。采用公钥密码体制，遵循X.509数字证书标准。</p>
</blockquote>
<p>持卡人-商家-支付网关</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703121711494.png" alt="image-20230703121711494" style="zoom:67%;" />
<p><strong>双重数字签名</strong>（SHA-1）</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703121737566.png" alt="image-20230703121737566" style="zoom: 50%;" />
<ul>
<li>用户：DS双重数字签名是$ E(H(PIMD||OIMD))$的数字签名</li>
<li>商家：PIMD、OI、DS 计算 $ H(PIMD||H(OI))$和DS用公钥解密</li>
<li>银行：OIMD、PI、DS 计算 $ H(H(PI)||OIMD)$和DS用公钥解密</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703122431782.png" alt="image-20230703122431782"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703122446520.png" alt="image-20230703122446520"></p>
<blockquote>
<p>SET是安全电子交易，是保证信用卡支付的安全开放规范，NonSET比如SSL（传输层，安全了连接）一类</p>
</blockquote>
<h2 id="WEP">WEP</h2>
<blockquote>
<p>无线网络安全缺陷：物理链路开放，窃听、通信阻断、注入攻击、中间人攻击、客户端/AP伪造<br>
802.11的安全机制<br>
身份认证<br>
开放式系统：公开SSID，是802.11的缺省设置，不认证<br>
封闭式系统：不公开SSID<br>
共享密钥认证：使用共享密钥和挑战-相应机制完成AP对接入点的认证</p>
</blockquote>
<p>WEP：提供访问控制和数据保密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="assets/image-20230703122956228.png" alt="image-20230703122956228"></p>
<ul>
<li>40密钥长度与IV串接，使用RC4（伪随机数发生器）产生密钥流</li>
<li>明文进行CRC校验与密钥流异或，传输时带上IV</li>
<li>检验方获得明文和CRC信息后对明文进行比对</li>
</ul>
<p>WEP协议<strong>弱点</strong></p>
<ul>
<li>密钥使用不规范</li>
<li>IV：24bit太短，明文传输，设计不合理（从0开始，数据包加一则IV+1）</li>
<li>CRC-32进行差错判断，被放入数据进行加密，无法预先进行数据完整性判断（先完整性再加密），且CRC有线性性。</li>
<li>没有提供源和目的地址的完整性校验信息，并且缺少重放攻击的对策</li>
</ul>
<p>安全增强</p>
<ul>
<li>标准的密钥交换和分发。802.11的共享密钥机制很不安全，可以用一系列协议来完成，例如RADIUS, Kerberos, SSL/TLS和IPSec.</li>
<li>使用104-bit WEP 密钥. 这个已经被广泛应用，40bit的密钥安全性很差 -&gt;WPA（Wi-Fi ProtectedAccess ）</li>
<li>使用带有密钥的MAC算法进行数据完整性校验（CRC太菜了）</li>
<li><strong>双向认证.</strong> 抵抗中间人窃取数据或者会话劫持</li>
<li>采用其他安全协议（WPA, WPA2, 802.1X, WAP1  ）</li>
</ul>
<p><strong>802.11i</strong>操作的5个阶段</p>
<ul>
<li>发现：<strong>AP</strong>使用信标和探测响应信息发布802.11i安全策略。站点（STA）则通过这些来希望确认希望进行通信的AP身份。STA访问接入点，当信标和探测响应提供选择时，选择加密套件和认证机制。</li>
<li>认证：STA和认证服务器各自互相证明各自身份。接入点组织STA和认证服务器直到认证成功前尚未被认证的数据。AP不参与认证，而是转发他们的认证数据</li>
<li>密钥生成和分发：接入点和STA几种操作后产生加密密钥，并配送到接入点和STA。数据帧只在AP和STA之间交换。</li>
<li>保密数据传输：数据帧在STA和终端站点之间通过AP交换。安全数据传输只发生在AP和STA之间（STA和终端站点之间的安全性不保证）</li>
<li>连接终止：AP和STA交换数据帧，安全连接解除</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://Ann-103.github.io">Ann</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ann-103.github.io/post/5ed8a930.html">https://ann-103.github.io/post/5ed8a930.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Ann-103.github.io" target="_blank">Ann の 小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/pinkcloud.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/771359ec.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/pinkcloud.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">c语言速成</div></div></a></div><div class="next-post pull-right"><a href="/post/9f4e6fbf.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/pinkcloud.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">随机过程</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-1-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%BB%BC%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">Chapter 1 网络安全综述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter3-IPsec%EF%BC%9AAH%E5%92%8CESP"><span class="toc-number">2.</span> <span class="toc-text">Chapter3 IPsec：AH和ESP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AH%E5%92%8CESP%E8%AE%A4%E8%AF%81%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">2.0.1.</span> <span class="toc-text">AH和ESP认证的区别</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-1-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%BB%BC%E8%BF%B0-2"><span class="toc-number">3.</span> <span class="toc-text">Chapter 1 网络安全综述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%84%E7%BD%AE"><span class="toc-number">3.1.</span> <span class="toc-text">预置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">3.2.</span> <span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E7%9A%84%E7%89%B9%E5%BE%81"><span class="toc-number">3.2.1.</span> <span class="toc-text">网络安全的特征</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B%E3%80%81%E5%AE%89%E5%85%A8%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.</span> <span class="toc-text">安全模型、安全体系结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">3.3.1.</span> <span class="toc-text">安全体系结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.3.2.</span> <span class="toc-text">安全模型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E7%9B%B8%E5%85%B3"><span class="toc-number">3.4.</span> <span class="toc-text">密码相关</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%9A%84%E5%8A%A0%E5%AF%86%E8%AE%A4%E8%AF%81%E3%80%81%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%AF%86%E7%A0%81"><span class="toc-number">3.5.</span> <span class="toc-text">基本的加密认证、密钥交换密码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-2-PKI"><span class="toc-number">4.</span> <span class="toc-text">Chapter 2 PKI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PKI%E6%A6%82%E5%BF%B5%E6%80%BB%E8%A7%88"><span class="toc-number">4.0.1.</span> <span class="toc-text">PKI概念总览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PKI%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">4.0.2.</span> <span class="toc-text">PKI的组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PKI%E5%92%8C%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84%E5%AF%86%E7%A0%81%E6%8A%80%E6%9C%AF"><span class="toc-number">4.0.3.</span> <span class="toc-text">PKI和电子商务中常用的密码技术</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E4%BF%A1%E5%B0%81"><span class="toc-number">4.0.3.1.</span> <span class="toc-text">数字信封</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PKI%E5%8A%9F%E8%83%BD%E6%93%8D%E4%BD%9C%E6%A6%82%E8%BF%B0"><span class="toc-number">4.0.4.</span> <span class="toc-text">PKI功能操作概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E6%A6%82%E8%A7%88"><span class="toc-number">4.0.5.</span> <span class="toc-text">证书概览</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%81%E4%B9%A6%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">4.0.6.</span> <span class="toc-text">证书的生命周期</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PKI%E4%BD%93%E7%B3%BB%E7%9A%84%E4%BA%92%E9%80%9A%E6%80%A7%E4%B8%8E%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">4.0.7.</span> <span class="toc-text">PKI体系的互通性与标准化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#X-509%E6%A0%87%E5%87%86"><span class="toc-number">4.0.8.</span> <span class="toc-text">X.509标准</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CA"><span class="toc-number">4.0.9.</span> <span class="toc-text">CA</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter3-IPSec%EF%BC%9AAH%E5%92%8CESP"><span class="toc-number">5.</span> <span class="toc-text">Chapter3 IPSec：AH和ESP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IPV4%E5%92%8CIPV6%E7%9A%84%E5%A4%B4%E6%A0%87"><span class="toc-number">5.0.1.</span> <span class="toc-text">IPV4和IPV6的头标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SA"><span class="toc-number">5.0.2.</span> <span class="toc-text">SA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88SPD%EF%BC%89"><span class="toc-number">5.0.3.</span> <span class="toc-text">安全策略数据库（SPD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E5%85%B3%E8%81%94%E6%95%B0%E6%8D%AE%E5%BA%93%EF%BC%88SAD%EF%BC%89"><span class="toc-number">5.0.4.</span> <span class="toc-text">安全关联数据库（SAD）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AH%EF%BC%9A%E8%AE%A4%E8%AF%81%E5%A4%B4%E6%A0%87"><span class="toc-number">5.0.5.</span> <span class="toc-text">AH：认证头标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AH%E5%A4%84%E7%90%86"><span class="toc-number">5.0.6.</span> <span class="toc-text">AH处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Esp%E5%A4%84%E7%90%86"><span class="toc-number">5.0.7.</span> <span class="toc-text">Esp处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ESP%E5%A4%84%E7%90%86"><span class="toc-number">5.0.8.</span> <span class="toc-text">ESP处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.0.9.</span> <span class="toc-text">总结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E6%A8%A1%E5%BC%8F%E5%92%8C%E9%9A%A7%E9%81%93%E6%A8%A1%E5%BC%8F"><span class="toc-number">5.0.10.</span> <span class="toc-text">传输模式和隧道模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPSec-VPN"><span class="toc-number">5.0.11.</span> <span class="toc-text">IPSec VPN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPSec%E4%B8%8ENAT"><span class="toc-number">5.0.12.</span> <span class="toc-text">IPSec与NAT</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-4-IKE"><span class="toc-number">6.</span> <span class="toc-text">Chapter 4 IKE</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-4"><span class="toc-number">7.</span> <span class="toc-text">Chapter 4</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IKE%EF%BC%88%E5%9B%A0%E7%89%B9%E7%BD%91%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E5%8D%8F%E8%AE%AE%EF%BC%89"><span class="toc-number">7.1.</span> <span class="toc-text">IKE（因特网密钥交换协议）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IKEv1"><span class="toc-number">7.1.1.</span> <span class="toc-text">IKEv1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IKV2"><span class="toc-number">7.1.2.</span> <span class="toc-text">IKV2</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-5-SSL-TLS%E5%9F%BA%E6%9C%AC%E5%8D%8F%E8%AE%AE"><span class="toc-number">8.</span> <span class="toc-text">Chapter 5 SSL&#x2F;TLS基本协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E7%9B%B8%E5%85%B3"><span class="toc-number">8.0.1.</span> <span class="toc-text">SSL相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E9%92%A5%E4%BA%A4%E6%8D%A2%E7%AE%97%E6%B3%95"><span class="toc-number">8.0.2.</span> <span class="toc-text">密钥交换算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SSL%E5%8D%8F%E8%AE%AE%E7%9A%84%E5%AE%89%E5%85%A8%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">8.0.3.</span> <span class="toc-text">SSL协议的安全性分析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-6%EF%BC%9A%E9%98%B2%E7%81%AB%E5%A2%99%E5%92%8CNAT"><span class="toc-number">9.</span> <span class="toc-text">Chapter 6：防火墙和NAT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NAT"><span class="toc-number">10.</span> <span class="toc-text">NAT</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-7-VPN"><span class="toc-number">11.</span> <span class="toc-text">Chapter 7 VPN</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#VPN%E6%A6%82%E8%BF%B0"><span class="toc-number">11.0.1.</span> <span class="toc-text">VPN概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#VPN-%E5%88%86%E7%B1%BB"><span class="toc-number">11.0.2.</span> <span class="toc-text">VPN 分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IPsec%E5%8D%8F%E8%AE%AE"><span class="toc-number">11.0.3.</span> <span class="toc-text">IPsec协议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chapter-8-%E5%BA%94%E7%94%A8%E5%B1%82%E5%AE%89%E5%85%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">12.</span> <span class="toc-text">Chapter 8 应用层安全协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#PGP"><span class="toc-number">12.1.</span> <span class="toc-text">PGP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SET%EF%BC%9A%E6%B6%88%E8%B4%B9%E8%80%85%EF%BC%8C%E5%95%86%E5%AE%B6%EF%BC%88OI%EF%BC%89%EF%BC%8C%E9%93%B6%E8%A1%8C%EF%BC%88PI%EF%BC%89"><span class="toc-number">12.2.</span> <span class="toc-text">SET：消费者，商家（OI），银行（PI）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WEP"><span class="toc-number">12.3.</span> <span class="toc-text">WEP</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By Ann</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="聊天"><i class="fas fa-sms"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-home"><i class="fa-solid fa-house"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/categories/"><i class="fa-solid fa-folder-open"></i><span>文章分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fa-solid fa-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuNormal"><div class="rightMenu-item" id="menu-translate"><i class="fa-solid fa-earth-asia"></i><span>繁简切换</span></div><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-moon"></i><span>切换模式</span></div><div class="rightMenu-item" id="menu-print"><i class="fa-solid fa-print fa-fw"></i><span>打印页面</span></div></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})
setTimeout(function(){preloader.endLoading();}, 20000)
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/copy-tex.min.js"></script><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'jlgkfToE73FxTz8kyHsmvdzb-gzGzoHsz',
      appKey: 'NN6nCIT47fGwz5Q1UyvFcGKP',
      avatar: 'retro',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer src="https://npm.elemecdn.com/jquery@latest/dist/jquery.min.js"></script><script defer data-pjax src="/js/rightMenu.js"></script><script src="/js/bibi.js"></script><script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script><script src="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-card-history/baiduhistory/js/main.js"></script><script async src="/js/categorybar.js"></script><script id="canvas_nest" defer="defer" color="0,0,0" opacity="0.3" zIndex="-1" count="99" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="//code.tidio.co/rqgufy4kvia1f5lhh0o1yhh6jhybgstp.js" async="async"></script><script>function onTidioChatApiReady() {
  window.tidioChatApi.hide();
  window.tidioChatApi.on("close", function() {
    window.tidioChatApi.hide();
  });
}
if (window.tidioChatApi) {
  window.tidioChatApi.on("ready", onTidioChatApiReady);
} else {
  document.addEventListener("tidioChat-ready", onTidioChatApiReady);
}

var chatBtnFn = () => {
  document.getElementById("chat_btn").addEventListener("click", function(){
    window.tidioChatApi.show();
    window.tidioChatApi.open();
  });
}
chatBtnFn()
</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" href="post/1563.html" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://s2.loli.net/2022/10/01/p6CQoLxsIWcu5zq.png" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-31</span><a class="blog-slider__title" href="post/1563.html" alt="">md公式输入语法</a><div class="blog-slider__text">常用的公式输入方法</div><a class="blog-slider__button" href="post/1563.html" alt="">详情   </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('已挂载butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><script async src="//at.alicdn.com/t/font_2032782_8d5kxvn09md.js"></script><!-- hexo injector body_end end --></body></html>